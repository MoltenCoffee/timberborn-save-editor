(this["webpackJsonptimberborn-save-editor"]=this["webpackJsonptimberborn-save-editor"]||[]).push([[0],{14:function(e,t,n){},15:function(e,t,n){},19:function(e,t,n){"use strict";n.r(t);var c={};n.r(c),n.d(c,"BeaverCopier",(function(){return p})),n.d(c,"DownloadPlugin",(function(){return g})),n.d(c,"MapSizePlugin",(function(){return y})),n.d(c,"StockpilePlugin",(function(){return k}));var a=n(1),r=n.n(a),s=n(8),i=n.n(s),l=(n(14),n(2)),o=(n(15),n(0));function b(e){var t=e.onSaveLoaded,n=Object(a.useState)(),c=Object(l.a)(n,2),r=c[0],s=c[1],i=Object(a.useCallback)((function(e){try{var n,c=null===(n=e.target)||void 0===n?void 0:n.files,a=null===c||void 0===c?void 0:c.item(0);if(!a)throw new Error("Expected file to be uploaded, found none");var i=new FileReader;i.onload=function(e){try{var n=JSON.parse(i.result);t(n)}catch(r){throw s(r),r}},i.readAsText(a,"utf-8")}catch(r){throw s(r),r}}),[t,s]);return Object(o.jsx)("div",{className:"container my-4",children:Object(o.jsx)("div",{className:"row",children:Object(o.jsx)("div",{className:"col-md-6 offset-md-3",children:Object(o.jsx)("label",{className:"card",children:Object(o.jsxs)("div",{className:"card-body",children:[Object(o.jsx)("h1",{className:"card-title",children:"Timberborn Save Editor"}),Object(o.jsxs)("div",{className:"mb-3",children:[Object(o.jsxs)("span",{className:"form-label",children:["Upload your ",Object(o.jsx)("b",{children:"Demo save"})," to start"]}),Object(o.jsx)("input",{type:"file",name:"save",accept:".json",onInput:i,className:"form-control"}),r?Object(o.jsx)("small",{className:"form-text",children:"#{error}"}):Object(o.jsxs)("small",{className:"form-text",children:["Default directory: ",Object(o.jsx)("code",{children:"%USERPROFILE%\\Documents\\Timberborn\\DemoSaves\\"})]})]})]})})})})})}function j(e){e.saveData;var t=e.onHome;return Object(o.jsx)("nav",{className:"navbar navbar-light bg-light",children:Object(o.jsx)("div",{className:"container",children:Object(o.jsx)("a",{href:"#",onClick:function(e){e.preventDefault(),t()},className:"navbar-brand",children:"Timberborn Save Editor"})})})}for(var d=Object(a.createContext)(void 0),u=n(4),m=n(3),O=n(9),h=[],v=0;v<256;v++)h[v]=(v<16?"0":"")+v.toString(16);var f={setAge:function(e,t,n){var c=e.Singletons.DayNightCycle.DayNumber;t.Components.Beaver.DayOfBirth=Math.floor(c-n)},setDefaultNeeds:function(e){var t,n=Object(O.a)(e.Components.NeedManager.Needs);try{for(n.s();!(t=n.n()).done;){var c=t.value;["Hunger","Thirst","Sleep"].includes(c.Name)&&(c.Points=1)}}catch(a){n.e(a)}finally{n.f()}},setDefaultName:function(e,t){var n=e.Singletons.NameService.Names;t.Components.Beaver.Name=Object(u.sample)(n)},reset:function(e){e.Id=function(){var e=4294967295*Math.random()|0,t=4294967295*Math.random()|0,n=4294967295*Math.random()|0,c=4294967295*Math.random()|0;return h[255&e]+h[e>>8&255]+h[e>>16&255]+h[e>>24&255]+"-"+h[255&t]+h[t>>8&255]+"-"+h[t>>16&15|64]+h[t>>24&255]+"-"+h[63&n|128]+h[n>>8&255]+"-"+h[n>>16&255]+h[n>>24&255]+h[255&c]+h[c>>8&255]+h[c>>16&255]+h[c>>24&255]}(),f.setDefaultNeeds(e),Object.assign(e.Components,{BehaviorManager:{RunningBehaviorId:"HomelessRootBehavior",RunningBehaviorOwner:e.Id,ReturnToBehavior:!1,TimestampedBehaviorLog:["HomelessRootBehavior 1.00"]}})}};function x(e){return JSON.parse(JSON.stringify(e))}var p={id:"BeaverCopier",name:"Beaver copier",group:"Beavers",position:1,enabled:!0,read:function(e){return e},write:function(e,t){return t},Preview:function(e){var t=e.saveData;return Object(o.jsx)(N,{entities:t.Entities})},Editor:function(e){var t=e.initialData,n=e.onClose,c=e.onSubmit,r=Object(a.useState)((function(){return t.Entities.filter((function(e){return"BeaverChild"===e.TemplateName||"BeaverAdult"===e.TemplateName}))})),s=Object(l.a)(r,2),i=s[0],b=s[1],j=Object(a.useState)(0),d=Object(l.a)(j,2),O=d[0],h=d[1],v=Object(a.useState)(10),p=Object(l.a)(v,2),g=p[0],y=p[1],S=Object(a.useState)(70),C=Object(l.a)(S,2),D=C[0],k=C[1],w=Object(u.sortBy)(i.slice(),(function(e){return-e.Components.Beaver.DayOfBirth})),B=O*g,M=Object(a.useCallback)((function(e){var n=x(e);return f.reset(n),f.setDefaultName(t,n),"BeaverAdult"===n.TemplateName&&f.setAge(t,e,5),n}),[t]),I=Object(a.useCallback)((function(e){b(i.slice().concat([M(e)]))}),[i,b,M]),E=Object(a.useCallback)((function(){var e=t.Entities.filter((function(e){return"BeaverChild"!==e.TemplateName&&"BeaverAdult"!==e.TemplateName})).concat(i);c(Object(m.a)(Object(m.a)({},t),{},{Entities:e}))}),[c,i,t]),P=g+B<i.length,T=Object(a.useCallback)((function(){for(var e=i.filter((function(e){return"BeaverAdult"===e.TemplateName})),t=(e.length>0?e:i).slice(0,D),n=t.slice();t.length<D;)t.push(M(Object(u.sample)(n)));b(t)}),[i,D,M]);return Object(o.jsx)("div",{className:"container my-4",children:Object(o.jsxs)("div",{className:"card",children:[Object(o.jsxs)("div",{className:"card-body",children:[Object(o.jsx)("h1",{className:"card-title",children:"Beaver Copier"}),Object(o.jsxs)("div",{className:"d-flex",children:[Object(o.jsx)("div",{children:Object(o.jsx)(N,{entities:i})}),Object(o.jsxs)("div",{className:"ms-auto",children:[Object(o.jsx)("button",{type:"button",onClick:n,className:"btn btn-light",children:"Discard changes"})," ",Object(o.jsx)("button",{type:"button",onClick:E,className:"btn btn-primary",children:"Submit"})]})]}),i.length>80?Object(o.jsxs)("div",{className:"alert alert-danger mt-1",children:[Object(o.jsx)("b",{children:"WARNING:"})," You have ",i.length," beavers. Newer versions of the Timberborn Demo will randomly crash with over 80 beavers."]}):null]}),Object(o.jsxs)("table",{className:"table my-0",children:[Object(o.jsx)("thead",{children:Object(o.jsxs)("tr",{children:[Object(o.jsx)("th",{children:"Name"}),Object(o.jsxs)("th",{children:["Age ",Object(o.jsx)("small",{style:{fontWeight:"normal"},children:"a-z"})]}),Object(o.jsx)("th",{children:"Coordinates"}),Object(o.jsx)("th",{})]})}),Object(o.jsx)("tbody",{children:w.slice(B,B+g).map((function(e){return Object(o.jsxs)("tr",{children:[Object(o.jsx)("td",{children:e.Components.Beaver.Name}),Object(o.jsxs)("td",{children:[t.Singletons.DayNightCycle.DayNumber-e.Components.Beaver.DayOfBirth," ","BeaverChild"===e.TemplateName?Object(o.jsx)("small",{children:"(child)"}):null]}),Object(o.jsxs)("td",{children:["x: ",Object(o.jsx)("b",{children:Math.round(e.Components.Beaver.Position.X)})," ","y: ",Object(o.jsx)("b",{children:Math.round(e.Components.Beaver.Position.Y)})," ","z: ",Object(o.jsx)("b",{children:Math.round(e.Components.Beaver.Position.Z)})," "]}),Object(o.jsx)("td",{className:"text-end py-1",children:Object(o.jsx)("button",{type:"button",className:"btn btn-light btn-sm",onClick:function(){return I(e)},children:"Copy"})})]},e.Id)}))}),Object(o.jsx)("tfoot",{children:Object(o.jsx)("tr",{children:Object(o.jsx)("td",{colSpan:4,className:"py-1",children:Object(o.jsxs)("div",{className:"d-flex",children:[Object(o.jsxs)("div",{className:"me-auto",children:["Showing ",Object(o.jsx)("strong",{children:B})," - ",Object(o.jsx)("strong",{children:Math.min(i.length,B+g)})," of ",Object(o.jsx)("strong",{children:i.length})]}),Object(o.jsxs)("form",{className:"me-3 d-flex",onSubmit:function(e){e.preventDefault(),T()},children:[Object(o.jsx)("label",{className:"form-label me-1 mt-1 mb-0",htmlFor:"addRandom",children:"Set beavers"}),Object(o.jsx)("input",{type:"number",id:"addRandom",className:"form-control form-control-sm",value:D,onChange:function(e){k(parseInt(e.target.value,10))},width:3,style:{width:60}}),Object(o.jsx)("button",{type:"submit",className:"ms-1 btn btn-primary btn-sm",children:"Set"})]}),Object(o.jsxs)("div",{className:"me-3 d-flex",children:[Object(o.jsx)("label",{className:"form-label me-1 mt-1 mb-0",htmlFor:"pageSize",children:"Pagesize"}),Object(o.jsxs)("select",{id:"pageSize",className:"form-control form-control-sm",value:g,onChange:function(e){h(0),y(parseInt(e.target.value,10))},children:[Object(o.jsx)("option",{children:"10"}),Object(o.jsx)("option",{children:"25"}),Object(o.jsx)("option",{children:"100"}),Object(o.jsx)("option",{children:"250"}),Object(o.jsx)("option",{children:"1000"}),Object(o.jsx)("option",{value:"".concat(Number.MAX_SAFE_INTEGER),children:"ALL"})]})]}),Object(o.jsxs)("div",{children:[Object(o.jsx)("button",{className:"btn btn-sm btn-light",disabled:O<=0,onClick:function(){return h(O-1)},children:"\u2039 prev"})," ",Object(o.jsx)("button",{className:"btn btn-sm btn-light",disabled:!P,onClick:function(){return h(O+1)},children:"next \u203a"})]})]})})})})]})]})})}};function N(e){var t=e.entities.reduce((function(e,t){return"BeaverAdult"===t.TemplateName&&e.adultCount++,"BeaverChild"===t.TemplateName&&e.childCount++,e}),{adultCount:0,childCount:0}),n=t.adultCount,c=t.childCount,a=n+c;return Object(o.jsxs)("span",{children:["You have ",Object(o.jsx)("strong",{children:a})," beavers: ",Object(o.jsx)("strong",{children:c})," kits and ",Object(o.jsx)("strong",{children:n})," adults."]})}var g={id:"DownloadPlugin",name:"Download",group:"General",position:-1,enabled:!0,read:function(e){return e},write:function(e,t){throw new Error("Not implemented")},Preview:function(e){e.saveData;return null},Editor:function(e){var t=e.initialData,n=e.onClose,c=Object(a.useMemo)((function(){return new Blob([JSON.stringify(t,null,2)],{type:"application/json"})}),[t]),r=URL.createObjectURL(c),s=new Date,i="".concat(s.toISOString().substr(0,10)," ").concat(s.getHours(),"h").concat(s.getMinutes(),"m, Day ").concat(t.Singletons.CycleService.Cycle,"-").concat(t.Singletons.CycleService.CycleDay," MODDED.json");return Object(o.jsx)("div",{className:"container",children:Object(o.jsx)("div",{className:"card my-4",children:Object(o.jsxs)("div",{className:"card-body",children:[Object(o.jsx)("h1",{className:"card-title",children:"Download"}),Object(o.jsxs)("div",{className:"d-flex",children:[Object(o.jsx)("a",{href:r,download:i,className:"btn btn-primary",onClick:function(){return n()},children:"Download"}),Object(o.jsx)("button",{type:"button",className:"btn btn-light ms-auto",onClick:n,children:"Close"})]})]})})})}},y={id:"MapSizePlugin",name:"Map size",group:"General",position:-1,enabled:!0,read:function(e){return{x:e.Singletons.MapSize.Size.X,y:e.Singletons.MapSize.Size.Y}},write:function(e,t){return e.Singletons.MapSize.Size.X=t.x,e.Singletons.MapSize.Size.Y=t.y,e},Preview:function(e){var t=e.saveData,n=t.Singletons.MapSize.Size.X,c=t.Singletons.MapSize.Size.Y;return Object(o.jsxs)("span",{children:[Object(o.jsx)("strong",{children:n})," \xd7 ",Object(o.jsx)("strong",{children:c})]})},Editor:function(e){var t=e.initialData,n=e.onClose,c=e.onSubmit,r=Object(a.useState)(t),s=Object(l.a)(r,2),i=s[0],b=s[1];return Object(o.jsx)("form",{onSubmit:function(e){e.preventDefault(),c(i)},children:Object(o.jsx)("div",{className:"container",children:Object(o.jsx)("div",{className:"card my-4",children:Object(o.jsxs)("div",{className:"card-body",children:[Object(o.jsx)("h1",{className:"card-title",children:"Map size editor"}),Object(o.jsx)("p",{children:"This is just a demo editor - changing this will likely break something."}),Object(o.jsxs)("div",{className:"mb-3",children:[Object(o.jsx)("label",{htmlFor:"x",className:"form-label",children:"X"}),Object(o.jsx)("input",{id:"x",type:"number",className:"form-control",value:i.x,onInput:function(e){return b(Object(m.a)(Object(m.a)({},i),{},{x:parseInt(e.target.value,10)}))}})]}),Object(o.jsxs)("div",{className:"mb-3",children:[Object(o.jsx)("label",{htmlFor:"y",className:"form-label",children:"Y"}),Object(o.jsx)("input",{id:"y",type:"number",className:"form-control",value:i.y,onInput:function(e){return b(Object(m.a)(Object(m.a)({},i),{},{y:parseInt(e.target.value,10)}))}})]}),Object(o.jsxs)("div",{className:"d-flex",children:[Object(o.jsx)("button",{type:"submit",className:"btn btn-primary",children:"Submit"}),Object(o.jsx)("button",{type:"button",className:"btn btn-light ms-auto",onClick:n,children:"Discard changes"})]})]})})})})}},S=n(5),C=function(e){return e.Entities.filter((function(e){return"SmallWarehouse"===e.TemplateName}))},D=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e.Components["Inventory:Stockpile"].Storage.Goods.reduce((function(e,t){var n=t.Good,c=t.Amount;return Object(m.a)(Object(m.a)({},e),{},Object(S.a)({},n.Id,c+(e[n.Id]||0)))}),t)},k={id:"StockpilePlugin",name:"Manage stockpile inventories",group:"Storage",position:10,enabled:!0,read:function(e){return e},write:function(e,t){return t},Preview:function(e){var t=e.saveData,n=Object(a.useMemo)((function(){return C(t)}),[t]),c=Object(a.useMemo)((function(){return n.reduce((function(e,t){return D(t,e)}),{})}),[n]);return Object(o.jsx)("div",{children:Object(o.jsx)(M,{counts:c})})},Editor:function(e){var t=e.initialData,n=e.onClose,c=e.onSubmit,r=Object(a.useState)(null),s=Object(l.a)(r,2),i=s[0],b=s[1],j=Object(a.useState)((function(){return C(t)})),d=Object(l.a)(j,2),O=d[0],h=d[1],v=Object(a.useCallback)((function(e){h(O.slice().map((function(t){return t.Id===e.Id?e:t}))),b(null)}),[h,O,b]),f=Object(a.useCallback)((function(){var e=Object(u.mapValues)(Object(u.groupBy)(O,"Id"),(function(e){return e[0]}));c(Object(m.a)(Object(m.a)({},t),{},{Entities:t.Entities.map((function(t){return e[t.Id]?e[t.Id]:t}))}))}),[c,t,O]);return Object(o.jsx)("div",{className:"container my-4",children:Object(o.jsxs)("div",{className:"card",children:[Object(o.jsxs)("div",{className:"card-body",children:[Object(o.jsx)("h1",{className:"card-title",children:"Manage stockpile inventories"}),Object(o.jsxs)("div",{className:"d-flex",children:[Object(o.jsx)("button",{type:"button",className:"btn btn-primary",onClick:f,children:"Submit"}),Object(o.jsx)("button",{type:"button",className:"btn btn-light ms-auto",onClick:n,children:"Discard changes"})]})]}),Object(o.jsx)("div",{className:"list-group list-group-flush",children:O.map((function(e){return i===e.Id?Object(o.jsx)(w,{setStockpile:v,stockpile:e},e.Id):Object(o.jsx)(B,{setStockpileId:b,stockpile:e},e.Id)}))})]})})}};function w(e){var t=e.stockpile,n=e.setStockpile,c=Object(a.useMemo)((function(){return t.Components.GoodDesirer.DesiredGoods.map((function(e){return e.Good.Id}))}),[t]),r=Object(a.useState)((function(){return D(t)})),s=Object(l.a)(r,2),i=s[0],b=s[1],j=Object(a.useCallback)((function(e){e.preventDefault(),n(Object(m.a)(Object(m.a)({},t),{},{Components:Object(m.a)(Object(m.a)({},t.Components),{},{"Inventory:Stockpile":{Storage:{Goods:Object(u.toPairs)(i).filter((function(e){var t=Object(l.a)(e,2),n=(t[0],t[1]);return n&&n>0})).map((function(e){var t=Object(l.a)(e,2);return{Good:{Id:t[0]},Amount:t[1]}}))}}})}))}),[t,n,i]),d=Object(a.useCallback)((function(e,t){b(Object(m.a)(Object(m.a)({},i),{},Object(S.a)({},e,t)))}),[b,i]);return Object(o.jsx)("div",{className:"list-group-item",children:Object(o.jsxs)("div",{className:"d-flex",children:[Object(o.jsxs)("div",{children:[Object(o.jsx)("b",{children:t.TemplateName}),Object(o.jsxs)("div",{children:["x: ",Object(o.jsx)("b",{children:Math.round(t.Components.BlockObject.Coordinates.X)})," ","y: ",Object(o.jsx)("b",{children:Math.round(t.Components.BlockObject.Coordinates.Y)})," ","z: ",Object(o.jsx)("b",{children:Math.round(t.Components.BlockObject.Coordinates.Z)})," "]})]}),Object(o.jsxs)("form",{className:"flex-fill",onSubmit:j,children:[c.map((function(e){return Object(o.jsxs)("div",{className:"row mb-3",children:[Object(o.jsx)("label",{className:"col-sm-2 col-form-label col-form-label-sm text-end",children:e}),Object(o.jsx)("div",{className:"col-sm-10",children:Object(o.jsx)("input",{className:"form-control form-control-sm",type:"number",onChange:function(t){d(e,t.target.valueAsNumber)},value:i[e]||""})})]},e)})),Object(o.jsx)("div",{className:"row",children:Object(o.jsx)("div",{className:"col-sm-10 offset-sm-2",children:Object(o.jsx)("button",{type:"submit",className:"btn btn-primary btn-sm",children:"OK"})})})]})]})})}function B(e){var t=e.stockpile,n=e.setStockpileId;return Object(o.jsx)("button",{onClick:function(){return n(t.Id)},className:"list-group-item list-group-item-action",children:Object(o.jsxs)("div",{className:"d-flex",children:[Object(o.jsxs)("div",{children:[Object(o.jsx)("b",{children:t.TemplateName}),Object(o.jsxs)("div",{children:["x: ",Object(o.jsx)("b",{children:Math.round(t.Components.BlockObject.Coordinates.X)})," ","y: ",Object(o.jsx)("b",{children:Math.round(t.Components.BlockObject.Coordinates.Y)})," ","z: ",Object(o.jsx)("b",{children:Math.round(t.Components.BlockObject.Coordinates.Z)})," "]})]}),Object(o.jsx)(M,{counts:D(t)})]})})}function M(e){var t=e.counts;return Object(o.jsx)("table",{className:"table table-sm table-borderless my-0",children:Object(o.jsx)("tbody",{children:Object(u.chunk)(Object(u.toPairs)(t),5).map((function(e,t){return Object(o.jsx)("tr",{children:Object(u.assign)(Object(u.fill)(new Array(5),["",""]),e).map((function(e,t){var n=Object(l.a)(e,2),c=n[0],a=n[1];return Object(o.jsxs)(o.Fragment,{children:[Object(o.jsx)("th",{style:{width:"17%"},className:"text-end",children:c},"k"+t),Object(o.jsx)("td",{style:{width:"3%"},className:"text-end",children:a},"v"+t)]})}))},t)}))})})}var I=Object(u.sortBy)(Object.values(c).filter((function(e){return e&&"object"===typeof e})),"position");function E(e){var t=e.saveData,n=e.onSelectPlugin,c=Object(a.useMemo)((function(){return Object(u.toPairs)(Object(u.groupBy)(I.filter((function(e){return"function"===typeof e.enabled?e.enabled({saveData:t}):e.enabled})),"group"))}),[t]);return Object(o.jsx)("div",{className:"container",children:c.map((function(e){var c=Object(l.a)(e,2),a=c[0],r=c[1];return Object(o.jsxs)("div",{className:"my-2",children:[Object(o.jsx)("h2",{className:"ps-2",children:a}),Object(o.jsx)("div",{className:"list-group my-2",children:r.map((function(e){var c=e.id,a=e.name,r=e.Preview;return Object(o.jsxs)("button",{type:"button",onClick:function(e){e.preventDefault(),n(c)},className:"list-group-item list-group-item-action",children:[Object(o.jsx)("div",{className:"fw-bold",children:a}),Object(o.jsx)("div",{children:Object(o.jsx)(r,{saveData:t})})]},c)}))})]},a)}))})}function P(e){var t=e.saveData,n=e.pluginId,c=e.onClose,r=e.onSubmit,s=Object(a.useMemo)((function(){return I.find((function(e){return e.id===n}))}),[n]),i=s.Editor,l=s.read,b=s.write,j=Object(a.useMemo)((function(){return l(x(t))}),[l,t]),d=Object(a.useCallback)((function(e){r(x(b(t,e)))}),[b,t,r]);return Object(o.jsx)(i,{initialData:j,onClose:c,onSubmit:d})}function T(e){var t=e.saveData,n=e.onSubmit,c=Object(a.useState)(null),r=Object(l.a)(c,2),s=r[0],i=r[1],b=Object(a.useCallback)((function(e){n(e),i(null)}),[n]),d=Object(a.useCallback)((function(){s?window.confirm("Discard changes in this form? Earlier changes will not be discarded.")&&i(null):window.confirm("Close this save file?")&&n(null)}),[s,n]);return Object(o.jsxs)(o.Fragment,{children:[Object(o.jsx)(j,{onHome:d}),null===s?Object(o.jsx)(E,{saveData:t,onSelectPlugin:i}):Object(o.jsx)(P,{saveData:t,pluginId:s,onClose:function(){return i(null)},onSubmit:b})]})}var z=function(){var e=Object(a.useState)(null),t=Object(l.a)(e,2),n=t[0],c=t[1];return Object(o.jsx)(o.Fragment,{children:null===n?Object(o.jsxs)(o.Fragment,{children:[Object(o.jsx)(j,{onHome:function(){}}),Object(o.jsx)(b,{onSaveLoaded:c})]}):Object(o.jsx)(d.Provider,{value:{saveData:n},children:Object(o.jsx)(T,{saveData:n,onSubmit:c})})})},A=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,20)).then((function(t){var n=t.getCLS,c=t.getFID,a=t.getFCP,r=t.getLCP,s=t.getTTFB;n(e),c(e),a(e),r(e),s(e)}))};i.a.render(Object(o.jsx)(r.a.StrictMode,{children:Object(o.jsx)(z,{})}),document.getElementById("root")),A()}},[[19,1,2]]]);
//# sourceMappingURL=main.c7b79aa8.chunk.js.map